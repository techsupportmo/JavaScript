<!DOCTYPE html>
<html>

<head>
    <title>World Temperature Data</title>

    <!-- Importing Chart.js-->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.6.2/dist/chart.min.js"></script>

</head>

<body>

    <!-- Creating canvas -->
    <canvas id="chart" width="400" height="400"></canvas>

    <script>
        // Temperature Data from: https://data.giss.nasa.gov/gistemp/
        // Mean from: https://earthobservatory.nasa.gov/world-of-change/global-temperatures

        // Created array to store labels on the x axis 
        const xlabels = [];
        const ytemps = [];

        createChart();
        //getData();

        async function createChart() {

            //CODE TO CREATE CHART
            // -----------------------------------------------------------------------------------
            
            // The chart will be created ONLY when the data is collected
            await getData();

            const ctx = document.getElementById('chart').getContext('2d');

            const myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: xlabels,
                    datasets: [{
                        label: 'Global Average Temperature',
                        data: ytemps,
                        backgroundColor: ['rgba(255, 99, 132, 0.2)'],
                        borderColor: ['rgba(255, 99, 132, 1)'],
                        borderWidth: 1
                    }]
                },

            });


            // -----------------------------------------------------------------------------------

        }



        // function to fetch CSV file
        // Uses async/await because it is an asynchronous function
        async function getData() {
            const response = await fetch('ZonAnn.Ts+dSST.csv');
            const data = await response.text();
            //console.log(data)

            // split() -
            // splitting the entire table into indivdiual rows (seperate by newline) 
            // and storing into an array

            // slice() - 
            // makes a copy of a portion of an array - from index 1 to the end
            // This essentially removes the first row (with the headings)

            table = data.split('\n').slice(1);

            // foreach() - This allows us to apply something to each element fo the array
            table.forEach(row => {
                // Splits each row into individual elements (columns)
                const columns = row.split(',');

                // Prints out row broken into individual elements (columns)
                //console.log(columns);

                // Stores year (first element of each row)
                const year = columns[0];

                // Now that year is stored, we store them into xlabels array
                xlabels.push(year)

                // Stores temperature (second element of each row)
                const temp = columns[1];

                // Now that the temperature is stored, we store them into ytemps array
                ytemps.push(temp);

                // Prints out YEAR and TEMPERATURE for each row of the table
                console.log(year, temp);
            })


        }


    </script>
</body>

</html>